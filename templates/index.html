<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Pre-Grader Control Panel</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <main class="layout">
      <header>
        <h1>AI Pre-Grader Control Panel</h1>
      </header>

      <section class="controls">
        <div class="control-sliders">
          <div class="control-group">
            <label for="concurrency">Concurrent Runs: <span id="concurrency-value">{{ max_concurrent }}</span></label>
            <input
              type="range"
              id="concurrency"
              name="concurrency"
              min="1"
              max="10"
              value="{{ max_concurrent }}"
            />
          </div>
          <div class="control-group">
            <label for="nitpickiness">Nitpickiness: <span id="nitpickiness-value">{{ nitpickiness }}</span></label>
            <input
              type="range"
              id="nitpickiness"
              name="nitpickiness"
              min="1"
              max="5"
              value="{{ nitpickiness }}"
            />
          </div>
        </div>
        <div class="status" id="status">Status: {{ status }}</div>
      </section>

      <section class="notes">
        <label for="grading-notes">Grading Notes</label>
        <textarea
          id="grading-notes"
          name="grading-notes"
          rows="5"
          placeholder="Add context for the grader, such as key concepts or specific mistakes to watch for.">{{ grading_notes }}</textarea>
      </section>

      <section class="panels">
        <article class="panel" data-category="solutions">
          <h2>Solution</h2>
          <p class="panel-description">Drop a PDF or use the upload button.</p>
          <div class="drop-area" data-category="solutions">
            <p>Drop PDF here</p>
            <input type="file" accept="application/pdf" />
          </div>
          <div class="panel-actions">
            <button class="button" data-action="generate">Generate Solution</button>
            <button class="button secondary" data-action="wipe">Wipe Folder</button>
          </div>
          <div class="file-groups">
            <div class="file-group">
              <h3>Uploaded Files</h3>
              <ul class="file-list" data-category="solutions">
                {% for name in files['solutions'] %}
                <li>{{ name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="file-group">
              <h3>Stored Files</h3>
              {% set stored = appdata_files['solutions'] %}
              <ul class="file-list" data-appdata-category="solutions">
                {% if stored.files %}
                {% for name in stored.files %}
                <li>{{ name }}</li>
                {% endfor %}
                {% else %}
                <li class="empty">
                  {% if stored.exists %}
                  No stored files found.
                  {% else %}
                  Folder not found.
                  {% endif %}
                </li>
                {% endif %}
              </ul>
            </div>
          </div>
        </article>

        <article class="panel" data-category="problems">
          <h2>Problems</h2>
          <p class="panel-description">Drop a PDF or use the upload button.</p>
          <div class="drop-area" data-category="problems">
            <p>Drop PDF here</p>
            <input type="file" accept="application/pdf" />
          </div>
          <div class="panel-actions">
            <button class="button secondary" data-action="wipe">Wipe Folder</button>
          </div>
          <div class="file-groups">
            <div class="file-group">
              <h3>Uploaded Files</h3>
              <ul class="file-list" data-category="problems">
                {% for name in files['problems'] %}
                <li>{{ name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="file-group">
              <h3>Stored Files</h3>
              {% set stored = appdata_files['problems'] %}
              <ul class="file-list" data-appdata-category="problems">
                {% if stored.files %}
                {% for name in stored.files %}
                <li>{{ name }}</li>
                {% endfor %}
                {% else %}
                <li class="empty">
                  {% if stored.exists %}
                  No stored files found.
                  {% else %}
                  Folder not found.
                  {% endif %}
                </li>
                {% endif %}
              </ul>
            </div>
          </div>
        </article>

        <article class="panel" data-category="submissions">
          <h2>Student Submissions</h2>
          <p class="panel-description">
            Drop a single PDF or a folder of PDFs, or use the upload button.
          </p>
          {% set assignment_list = assignments or [] %}
          {% set has_assignments = assignment_list|length > 0 %}
          {% set new_mode = (assignment_title and assignment_title not in assignment_list) or (not has_assignments and not assignment_title) %}
          <div class="form-group">
            <label for="assignment-selector">Assignment</label>
            <select id="assignment-selector" name="assignmentSelector">
              <option value="" disabled {% if not new_mode and not assignment_title %}selected{% endif %}>
                Select an assignment
              </option>
              {% for name in assignment_list %}
              <option value="{{ name }}" {% if name == assignment_title %}selected{% endif %}>{{ name }}</option>
              {% endfor %}
              <option value="__new__" {% if new_mode %}selected{% endif %}>Create new assignmentâ€¦</option>
            </select>
          </div>
          <div class="form-group" id="new-assignment-group" {% if not new_mode %}hidden{% endif %}>
            <label for="assignment-title">New Assignment Title</label>
            <input
              type="text"
              id="assignment-title"
              name="assignmentTitle"
              placeholder="Enter assignment title"
              value="{% if new_mode %}{{ assignment_title }}{% endif %}"
            />
          </div>
          <div class="drop-area" data-category="submissions">
            <p>Drop PDF or folder here</p>
            <input type="file" accept="application/pdf" webkitdirectory directory multiple />
          </div>
          <div class="panel-actions">
            <button class="button" data-action="grade">Grade Submission</button>
            <button class="button secondary" data-action="wipe">Wipe Folder</button>
          </div>
          <div class="file-groups">
            <div class="file-group">
              <h3>Uploaded Files</h3>
              <ul class="file-list" data-category="submissions">
                {% for name in files['submissions'] %}
                <li>{{ name }}</li>
                {% endfor %}
              </ul>
            </div>
            <div class="file-group">
              <h3>Stored Files</h3>
              {% set stored = appdata_files['submissions'] %}
              <ul class="file-list" data-appdata-category="submissions">
                {% if stored.files %}
                {% for name in stored.files %}
                <li>{{ name }}</li>
                {% endfor %}
                {% else %}
                <li class="empty">
                  {% if stored.exists %}
                  No stored files found.
                  {% else %}
                  Folder not found.
                  {% endif %}
                </li>
                {% endif %}
              </ul>
            </div>
          </div>
        </article>
      </section>
    </main>

    <script src="{{ url_for('static', filename='app.js') }}" defer></script>
  </body>
</html>
